/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 12.1 		*/
/*  Created On : 31-èþë-2023 21:30:38 				*/
/*  DBMS       : PostgreSQL 						*/
/* ---------------------------------------------------- */

/* Drop Tables */

DROP TABLE IF EXISTS DEPARTMENT CASCADE
;

DROP TABLE IF EXISTS DOLGNOST CASCADE
;

DROP TABLE IF EXISTS MEETING_ROOMS CASCADE
;

DROP TABLE IF EXISTS ORDERS_MEETING_ROOMS CASCADE
;

DROP TABLE IF EXISTS ROLES CASCADE
;

DROP TABLE IF EXISTS STATUS CASCADE
;

DROP TABLE IF EXISTS USERS CASCADE
;

/* Create Tables */

CREATE TABLE DEPARTMENT
(
	ID_DEP integer NOT NULL,
	S_DEP varchar(30) NOT NULL
)
;

CREATE TABLE DOLGNOST
(
	ID_DOLG integer NOT NULL,
	S_DOLG varchar(30) NOT NULL
)
;

CREATE TABLE MEETING_ROOMS
(
	ID_ROOM integer NOT NULL,
	S_ADRESS varchar(150) NOT NULL,    -- Àäðåñ èëè íàèìåíîâàíèå çäàíèÿ, åñëè ýòî ïðîìïëîùàäêà
	S_CABINET varchar(20) NOT NULL,
	I_SEATING_PLACES integer NOT NULL   DEFAULT 0,
	B_HAS_PROJECTOR smallint NOT NULL   DEFAULT 0,
	B_HAS_INTERNET smallint NOT NULL   DEFAULT 0,
	ID_STATUS smallint NOT NULL,
	DT_IN_ENABLE timestamp without time zone NULL,    -- Ïëàíèðóåìàÿ äàòà âîçâðàòà â ñòàòóñ "Äîñòóïíà", óêàçûâàåòñÿ ïðè ïåðåêëþ÷åíèè â ñòàòóñ "Íå äîñòóïíà"
	B_DEL smallint NOT NULL   DEFAULT 0,
	DT_INS timestamp without time zone NOT NULL   DEFAULT CURRENT_TIMESTAMP
)
;

CREATE TABLE ORDERS_MEETING_ROOMS
(
	ID_ORDER integer NOT NULL,
	DT_BEGIN timestamp without time zone NOT NULL,
	DT_END timestamp without time zone NOT NULL,
	S_COMMENT varchar(255) NULL,    -- Îïèñàíèå òðåáîâàíèé äëÿ ïîäãîòîâêè ïåðåãîâîðíîé
	I_SEATING_PLACES integer NOT NULL   DEFAULT 0,
	B_HAS_PROJECTOR smallint NOT NULL   DEFAULT 0,
	B_HAS_INTERNET smallint NOT NULL   DEFAULT 0,
	ID_USER integer NOT NULL,
	ID_ROOM integer NOT NULL,
	ID_STATUS smallint NOT NULL,
	ID_USER_AGREEMENT integer NULL,
	B_DEL smallint NOT NULL   DEFAULT 0,
	DT_INS timestamp without time zone NOT NULL   DEFAULT CURRENT_TIMESTAMP
)
;

CREATE TABLE ROLES
(
	ID_ROLE smallint NOT NULL,
	S_ROLE varchar(50) NOT NULL
)
;

CREATE TABLE STATUS
(
	ID_STATUS smallint NOT NULL,
	S_STATUS varchar(30) NOT NULL,
	S_COMMENT varchar(200) NULL
)
;

CREATE TABLE USERS
(
	ID_USER integer NOT NULL,
	S_FAM varchar(50) NOT NULL,
	S_NAME varchar(50) NOT NULL,
	S_OTCH varchar(50) NULL,
	EMAIL varchar(50) NOT NULL,
	S_PASSW varchar(30) NOT NULL,
	S_PHONE varchar(11) NOT NULL,
	ID_DEP integer NOT NULL,
	ID_DOLG integer NOT NULL,
	ID_ROLE smallint NOT NULL,
	B_DEL smallint NOT NULL   DEFAULT 0,
	DT_INS timestamp without time zone NOT NULL   DEFAULT CURRENT_TIMESTAMP
)
;

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE DEPARTMENT ADD CONSTRAINT PK_DEPARTMENT
	PRIMARY KEY (ID_DEP)
;

ALTER TABLE DOLGNOST ADD CONSTRAINT PK_DOLGNOST
	PRIMARY KEY (ID_DOLG)
;

ALTER TABLE MEETING_ROOMS ADD CONSTRAINT PK_MEETING_ROOMS
	PRIMARY KEY (ID_ROOM)
;

CREATE INDEX IX_MR_B_DEL ON MEETING_ROOMS (B_DEL ASC)
;

CREATE INDEX IXFK_MR_ID_STATUS ON MEETING_ROOMS (ID_STATUS ASC)
;

ALTER TABLE ORDERS_MEETING_ROOMS ADD CONSTRAINT PK_ORDERS_MEETING_ROOMS
	PRIMARY KEY (ID_ORDER)
;

CREATE INDEX IXFK_OMR_ID_ROOM ON ORDERS_MEETING_ROOMS (ID_ROOM ASC)
;

CREATE INDEX IXFK_OMR_ID_STATUS ON ORDERS_MEETING_ROOMS (ID_STATUS ASC)
;

CREATE INDEX IXFK_OMR_ID_USERS ON ORDERS_MEETING_ROOMS (ID_USER ASC)
;

CREATE INDEX IX_OMR_B_DEL ON ORDERS_MEETING_ROOMS (B_DEL ASC)
;

ALTER TABLE ROLES ADD CONSTRAINT PK_ROLES
	PRIMARY KEY (ID_ROLE)
;

ALTER TABLE STATUS ADD CONSTRAINT PK_STATUS
	PRIMARY KEY (ID_STATUS)
;

ALTER TABLE USERS ADD CONSTRAINT PK_USERS
	PRIMARY KEY (ID_USER)
;

CREATE INDEX IXFK_USERS_DEPARTMENT ON USERS (ID_DEP ASC)
;

CREATE INDEX IXFK_USERS_DOLGNOST ON USERS (ID_DOLG ASC)
;

/* Create Foreign Key Constraints */

ALTER TABLE MEETING_ROOMS ADD CONSTRAINT FK_MR_STATUS
	FOREIGN KEY (ID_STATUS) REFERENCES STATUS (ID_STATUS) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE ORDERS_MEETING_ROOMS ADD CONSTRAINT FK_OMR_MR
	FOREIGN KEY (ID_ROOM) REFERENCES MEETING_ROOMS (ID_ROOM) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE ORDERS_MEETING_ROOMS ADD CONSTRAINT FK_OMR_STATUS
	FOREIGN KEY (ID_STATUS) REFERENCES STATUS (ID_STATUS) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE ORDERS_MEETING_ROOMS ADD CONSTRAINT FK_OMR_USER_AGREEMENT
	FOREIGN KEY (ID_USER_AGREEMENT) REFERENCES USERS (ID_USER) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE ORDERS_MEETING_ROOMS ADD CONSTRAINT FK_OMR_USERS
	FOREIGN KEY (ID_USER) REFERENCES USERS (ID_USER) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE USERS ADD CONSTRAINT FK_USERS_DEPARTMENT
	FOREIGN KEY (ID_DEP) REFERENCES DEPARTMENT (ID_DEP) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE USERS ADD CONSTRAINT FK_USERS_DOLGNOST
	FOREIGN KEY (ID_DOLG) REFERENCES DOLGNOST (ID_DOLG) ON DELETE No Action ON UPDATE No Action
;

ALTER TABLE USERS ADD CONSTRAINT FK_USERS_ROLES
	FOREIGN KEY (ID_ROLE) REFERENCES ROLES (ID_ROLE) ON DELETE No Action ON UPDATE No Action
;

/* Create Table Comments, Sequences for Autonumber Columns */

COMMENT ON COLUMN MEETING_ROOMS.S_ADRESS
	IS 'Адрес или наименование здания, если это промплощадка'
;

COMMENT ON COLUMN MEETING_ROOMS.DT_IN_ENABLE
	IS 'Планируемая дата возврата в статус "Доступна", указывается при переключении в статус "Не доступна"'
;

COMMENT ON COLUMN ORDERS_MEETING_ROOMS.S_COMMENT
	IS 'Описание требований для подготовки переговорной'
;
